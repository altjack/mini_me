# ==========================================
# Configurazione Agent Daily Report GA4
# ==========================================

# Configurazione Agente AI
agent:
  # Modello Anthropic da utilizzare
  # Opzioni: "claude-sonnet-4.5", "claude-haiku-4-5-20251001"
  model: "claude-sonnet-4-5-20250929"
  
  # Verbose output durante l'esecuzione
  verbose: true

# Configurazione Database (SQLite + Redis Cache)
database:
  sqlite:
    # Percorso file database SQLite
    path: "data/ga4_data.db"
    
    # Backup automatico abilitato
    backup_enabled: true
    
    # Directory per backup
    backup_dir: "data/backups"
    
    # Frequenza backup (weekly, daily)
    backup_frequency: "weekly"
  
  redis:
    # Host Redis (default: localhost)
    host: "localhost"
    
    # Porta Redis (default: 6379)
    port: 6379
    
    # Database Redis per cache GA4 (1 = separato da memoria agente)
    db: 1
    
    # Prefisso chiavi Redis per metriche GA4
    key_prefix: "ga4:metrics:"
    
    # TTL cache in giorni (sliding window ultimi 21 giorni per confronti promo)
    ttl_days: 21

# Configurazione Redis per memoria agente (deprecato - ora in database.redis)
redis:
  # Host Redis (default: localhost per installazione locale)
  host: "localhost"
  
  # Porta Redis (default: 6379)
  port: 6379
  
  # Database Redis da utilizzare (0-15)
  db: 0
  
  # Prefisso chiavi Redis per questa applicazione
  # Tutte le chiavi useranno questo prefisso per evitare conflitti
  memory_prefix: "agent:memory:weborder"

# Configurazione GA4 Extraction
ga4_extraction:
  # Giorni di storico per backfill iniziale
  backfill_days: 365
  
  # Offset giorni per confronto (default: 7 giorni prima)
  comparison_offset: 7

# Configurazione Esecuzione
execution:
  # Cartella contenente i CSV generati dal cron job (LEGACY - ora usa database)
  data_source: "output"
  
  # Cartella dove salvare le email generate
  output_dir: "email"
  
  # Nome file draft email corrente
  draft_filename: "draft_email.md"
  
  # Cartella archivio email approvate
  archive_dir: "email/archive"
  
  # Prompt task per l'agente
  # Questo è il prompt iniziale che viene inviato all'agente quando eseguito
  task_prompt: >
    SCRIVI ORA l'email del report giornaliero GA4. Dopo aver chiamato i tool necessari, 
    la tua risposta finale DEVE CONTENERE SOLO IL TESTO COMPLETO DELL'EMAIL (minimo 500 parole).
    
    NON rispondere MAI con frasi come "Procedo a...", "Ecco l'email...", "Ora scrivo...".
    La tua risposta finale deve INIZIARE DIRETTAMENTE con il contenuto dell'email.
    
    WORKFLOW (esegui tutto in questo turno):
    
    1. Chiama get_daily_report() per ottenere metriche e confronti
    2. Chiama get_active_promos() per verificare promozioni attive
    3. Se suggerito, chiama compare_promo_periods() per confronto promo
    4. SCRIVI IMMEDIATAMENTE l'email completa basandoti sui dati ottenuti
    
    STILE EMAIL (emula gli esempi nel system prompt):
    - Apertura diretta con metrica principale (es. "Giovedì 18 dicembre registra 86 SWI...")
    - Variazioni percentuali con confronto temporale
    - Dettaglio prodotti con percentuali (Fixa, Pernoi, Trend, Sempre)
    - Sessioni commodity e Luce&Gas
    - CR commodity, CR Luce&Gas, CR canalizzazione
    - Promozioni attive con impatto su performance
    - Chiusura con firma "Giacomo"
    
    REQUISITI TECNICI:
    - USA SOLO dati REALI dai tool
    - Formato markdown
    - L'email deve essere COMPLETA e PRONTA per l'invio
    
    RIPETO: La tua risposta finale NON deve contenere preamboli o meta-commenti.
    DEVE essere SOLO il testo dell'email, che inizia direttamente con l'analisi del giorno.

# Configurazione Email Examples
examples:
  # File contenente esempi email storiche
  source_file: "history.md"
  
  # Numero esempi da includere nel context
  sample_size: 15
  
  # Strategia sampling ("recent_weighted", "recent", "random")
  sampling_strategy: "recent_weighted"
  
  # Token budget massimo per esempi (safety)
  max_tokens: 7000

# Configurazione File Conversazione (DEPRECATED - usa examples sopra)

# Configurazione Logging
logging:
  # Livello log (DEBUG, INFO, WARNING, ERROR, CRITICAL)
  level: "INFO"

  # Directory per i log
  log_dir: "logs"

  # File log per operazioni agente
  agent_log: "logs/agent_execution.log"

  # File log per operazioni memoria
  memory_log: "logs/memory_operations.log"

# Opzioni Avanzate
advanced:
  # Numero massimo messaggi da includere nel contesto memoria
  # null = tutti i messaggi, numero = limita agli ultimi N
  max_memory_messages: null
  
  # Timeout esecuzione agente in secondi
  agent_timeout: 300
  
  # Salva automaticamente logs delle esecuzioni
  save_execution_logs: true
  
  # Formato timestamp per file archiviati
  timestamp_format: "%Y%m%d_%H%M%S"

